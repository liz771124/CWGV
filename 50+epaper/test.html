<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Scroll to Section with Swiper</title>
    <link
      rel="stylesheet"
      href="https://unpkg.com/swiper/swiper-bundle.min.css"
    />
    <style>
      body {
        margin: 0;
        padding: 0;
        font-family: Arial, sans-serif;
      }

      section {
        height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2em;
      }

      #navbar {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        background-color: #333;
        color: #fff;
        padding: 10px;
        text-align: center;
      }

      #slider {
        height: 50px;
        background-color: #f00;
        color: #fff;
        text-align: center;
        padding: 10px;
      }

      .swiper-container {
        width: 100%;
        height: 100%;
      }

      .swiper-slide {
        text-align: center;
        font-size: 18px;
        background: #fff;
        padding: 40px 0;
        box-sizing: border-box;
      }

      .swiper-slide-active {
        background: #f00; /* 設定 active slide 的背景色 */
      }
    </style>
  </head>
  <body>
    <div id="navbar">Navbar</div>
    <div id="slider">Slider</div>

    <!-- Swiper -->
    <div class="swiper-container">
      <div class="swiper-wrapper">
        <div class="swiper-slide">Slide 1</div>
        <div class="swiper-slide">Slide 2</div>
        <div class="swiper-slide">Slide 3</div>
        <div class="swiper-slide">Slide 4</div>
        <div class="swiper-slide">Slide 5</div>
        <div class="swiper-slide">Slide 6</div>
      </div>
    </div>

    <section id="section1">Section 1</section>
    <section id="section2">Section 2</section>
    <section id="section3">Section 3</section>
    <section id="section4">Section 4</section>
    <section id="section5">Section 5</section>
    <section id="section6">Section 6</section>
    <section id="section7">Section 7</section>
    <section id="section8">Section 8</section>

    <script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        var swiper = new Swiper(".swiper-container", {
          slidesPerView: 3,
          spaceBetween: 30,
          navigation: {
            nextEl: ".swiper-button-next",
            prevEl: ".swiper-button-prev",
          },
        });

        // 找到所有錨點
        var anchors = document.querySelectorAll('a[href^="#"]');

        // 監聽滾動事件
        window.addEventListener("scroll", function () {
          // 找到目前可視的 section
          var currentSection = null;
          var currentSectionIndex = 0;

          document
            .querySelectorAll("section")
            .forEach(function (section, index) {
              var rect = section.getBoundingClientRect();
              if (
                rect.top <= window.innerHeight / 2 &&
                rect.bottom >= window.innerHeight / 2
              ) {
                currentSection = section;
                currentSectionIndex = index;
              }
            });

          // 將對應的 swiper-slide 設置為 active
          swiper.slideTo(currentSectionIndex);

          // 更新 active slide 的樣式
          document
            .querySelectorAll(".swiper-slide")
            .forEach(function (slide, index) {
              if (index === currentSectionIndex) {
                slide.classList.add("swiper-slide-active");
              } else {
                slide.classList.remove("swiper-slide-active");
              }
            });
        });

        // 監聽每個錨點的點擊事件
        anchors.forEach(function (anchor) {
          anchor.addEventListener("click", function (e) {
            e.preventDefault(); // 防止默認的錨點行為

            // 取得目標區塊的 ID
            var targetId = this.getAttribute("href").substring(1);

            // 找到目標區塊
            var targetElement = document.getElementById(targetId);

            if (targetElement) {
              // 計算滑動的目標高度（扣除 navbar 與 slider 的高度）
              var targetOffset =
                targetElement.offsetTop -
                document.getElementById("navbar").offsetHeight -
                document.getElementById("slider").offsetHeight;

              // 使用滾動動畫滑動到目標高度
              window.scrollTo({
                top: targetOffset,
                behavior: "smooth",
              });
            }
          });
        });
      });
    </script>
  </body>
</html>
